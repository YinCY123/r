---
title: "14_Principal-components-and-factor-analysis"
author: "yincy"
date: "3/26/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Principal components 
```{r}
library(psych)
```

Principal components analysis (PCA) is a data-reduction technique that transforms a larger number of correlated variables into a much smaller set of uncorrelated variables called principal components.  

The goal of PCA is to replace a large number of correlated variables with a smaller number of uncorrelated variables while capturing as much information in the original variables as possible.  

These derived variables, called principal components, are linear combinations of the observed variables.  


### Selecting the number of components to extract
**Methods for deciding how many components to retain in a PCA**  
- Basing the number of components on prior experience and theory  
- Selecting the number of components needed to account for some threshold cumulative amount of variance in the variables (for example, 80%).  
- Selecting the number of components to retain by examining the eigenvalues of the k x k correlation matrix among the variables.  

The most common approach is based on the eigenvalues. Each component is associated with an eigenvalue of the correlation matrix. The first PC is associated with the largest eigenvalue, the second PC with the second-largest eigenvalue, and so on. The Kaiser–Harris criterion suggests retaining components with eigenvalues greater than 1.  

```{r}
library(magrittr)
data("USJudgeRatings")
pc <- principal(USJudgeRatings[, -1], nfactors = 1)
pc
```


```{r}
data("Harman23.cor")
```

```{r}
fa.parallel(Harman23.cor$cov, n.obs = 302, fa = "pc", n.iter = 100)
```

```{r}
pc <- principal(Harman23.cor$cov, nfactors = 2, rotate = "none")
pc
```


### Rotating principal components
**Rotations are a set of mathematical techniques for transforming the component loading matrix into one that's more interpretable**. They do this by “purifying” the components as much as possible. Rotation methods differ with regard to whether the resulting components remain uncorrelated (orthogonal rotation) or are allowed to correlate (oblique rotation). They also differ in their definition of purifying.  

```{r}
rc <- principal(Harman23.cor$cov, nfactors = 2, rotate = "varimax")
rc
```

```{r}
pc <- principal(USJudgeRatings[, -1], nfactors = 1, scores = T)
pc$scores %>% head
```

```{r}
cor(USJudgeRatings[, 1], pc$scores)
```


## Exploratory factor analysis
The goal of Exploratory factor analysis is to explain the correlations among a set of observed variables by uncovering a smaller set of more fundamental unobserved variables underlying the data. These hypothetical, unobserved variables are called factors. (Each factor is assumed to explain the variance shared among two or more observed variables, so technically, they’re called common factors.)  


```{r}
covariance <- ability.cov$cov
correlations <- cov2cor(covariance)
```

```{r}
library(psych)
covariance <- ability.cov$cov
correlations <- cov2cor(covariance)
fa.parallel(correlations, n.obs = 112, fa = "both", n.iter = 100, 
            main = "Scree plots with parallel analysis")
```

```{r}
fa <- fa(correlations, nfactors = 2, rotate = "none", fm = "pa")
fa
```


```{r}
fa.varimax <- fa(correlations, nfactors = 2, rotate = "varimax", fm = "pa")
fa.varimax
```

```{r}
fa.promax <- fa(correlations, nfactors = 2, rotate = "promax", fm = "pa")
fa.promax
```








